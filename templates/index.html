<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§å­¦ç”Ÿå¿ƒç†åˆ†ææ•°å­—äººä»£ç† - å¸¦è¡¨æƒ…è¯†åˆ«</title>
    <style>
        /* ========== æ ·å¼ ========== */
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
        body{background:linear-gradient(135deg,#a8edea 0%,#fed6e3 100%);color:#333;min-height:100vh;padding:20px}
        .container{max-width:1200px;margin:0 auto}
        .header{text-align:center;padding:20px;margin-bottom:30px}
        .header h1{font-size:32px;color:#4a90e2;margin-bottom:10px}
        .header p{font-size:16px;color:#666}
        .main-content{display:flex;gap:20px;margin-bottom:30px}
        .left-panel,.right-panel{flex:1;background:rgba(255,255,255,.9);border-radius:15px;padding:20px;box-shadow:0 8px 25px rgba(0,0,0,.1)}
        .panel-title{font-size:20px;color:#4a90e2;margin-bottom:15px;padding-bottom:10px;border-bottom:2px solid #eee}
        #scene-container{width:100%;height:300px;background:#f5f5f5;border-radius:10px;overflow:hidden;margin-bottom:15px;position:relative;display:flex;align-items:center;justify-content:center}
        #avatar-img{height:100%;max-width:100%;object-fit:contain}
        #avatar-video{width:100%;height:100%;object-fit:contain;display:none}
        #video-loading{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;display:none}
        #video-loading .spinner{width:40px;height:40px;border:4px solid #f3f3f3;border-top:4px solid #4a90e2;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 10px}
        #camera-preview{width:100%;height:250px;background:#333;border-radius:10px;margin-bottom:15px}
        .camera-controls{display:flex;gap:10px;margin-bottom:15px}
        .btn{padding:10px 20px;border:none;border-radius:8px;background:#4a90e2;color:white;font-size:14px;cursor:pointer;transition:all .3s}
        .btn:hover{background:#3a80d2;transform:translateY(-2px)}
        .btn:disabled{background:#ccc;cursor:not-allowed}
        .emotion-display{margin-top:20px;padding:15px;background:#f8f9fa;border-radius:10px}
        .emotion-result{font-size:24px;text-align:center;margin:10px 0}
        .chat-container{margin-bottom:30px}
        .response-bubble{background:white;padding:20px;border-radius:15px;margin-bottom:15px;box-shadow:0 4px 15px rgba(0,0,0,.1);min-height:100px;max-height:300px;overflow-y:auto}
        .input-container{display:flex;gap:10px}
        #user-input{flex:1;padding:15px;border:2px solid #4a90e2;border-radius:10px;font-size:16px;outline:none}
        #submit-btn{padding:15px 30px;background:linear-gradient(135deg,#4a90e2 0%,#357ae8 100%);color:white;border:none;border-radius:10px;font-size:16px;cursor:pointer;transition:all .3s}
        #submit-btn:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 6px 20px rgba(74,144,226,.4)}
        #submit-btn:disabled{background:#ccc;cursor:not-allowed}
        .status-indicator{position:fixed;top:20px;right:20px;background:rgba(46,204,113,.9);color:white;padding:8px 15px;border-radius:20px;font-size:14px;display:flex;align-items:center;gap:8px}
        .status-dot{width:8px;height:8px;background:white;border-radius:50%;animation:pulse 2s infinite}
        
        /* æ›´æ¢å½¢è±¡æŒ‰é’® */
        .change-avatar-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #4a90e2;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            font-size: 14px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .change-avatar-btn:hover {
            background: #3a80d2;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        .change-avatar-btn::before {
            content: "ğŸ‘¤";
        }
        
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
        @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
        @media (max-width:768px){.main-content{flex-direction:column}.header h1{font-size:24px}.change-avatar-btn{bottom:10px;right:10px;padding:8px 15px}}
    </style>
</head>
<body>
    <div class="container">
        <!-- æ›´æ¢å½¢è±¡æŒ‰é’® -->
        <a href="/select" class="change-avatar-btn">æ›´æ¢å½¢è±¡</a>
        
        <div class="header">
            <h1 id="page-title">å¤§å­¦ç”Ÿå¿ƒç†åˆ†ææ•°å­—äººä»£ç†</h1>
            <p id="page-subtitle">AIæ•°å­—äººç»“åˆè¡¨æƒ…åˆ†æï¼Œæä¾›æ›´ç²¾å‡†çš„å¿ƒç†çŠ¶æ€è¯„ä¼°</p>
        </div>

        <div class="status-indicator">
            <div class="status-dot"></div>
            <span id="status-text">ç³»ç»Ÿå°±ç»ª</span>
        </div>

        <div class="main-content">
            <div class="left-panel">
                <div class="panel-title">æ•°å­—äººäº¤äº’</div>
                <div id="scene-container">
                    <!-- æ•°å­—äººå›¾ç‰‡ -->
                    <img id="avatar-img" src="" alt="æ•°å­—äºº">
                    <!-- æ•°å­—äººè§†é¢‘ -->
                    <video id="avatar-video" controls style="display:none;width:100%;height:100%;object-fit:contain;"></video>
                    <!-- åŠ è½½åŠ¨ç”» -->
                    <div id="video-loading" style="display:none">
                        <div class="spinner"></div>
                        <p>æ­£åœ¨ç”Ÿæˆæ•°å­—äººè§†é¢‘...</p>
                    </div>
                </div>

                <div class="input-container">
                    <input type="text" id="user-input" placeholder="è¯·æè¿°ä½ å½“å‰çš„å¿ƒç†çŠ¶æ€æˆ–é‡åˆ°çš„é—®é¢˜...">
                    <button id="submit-btn" class="btn">å‘é€</button>
                </div>
            </div>

            <div class="right-panel">
                <div class="panel-title">è¡¨æƒ…åˆ†æ</div>
                <video id="camera-preview" autoplay playsinline style="display:none;"></video>

                <div class="camera-controls">
                    <button id="camera-toggle" class="btn">å¼€å¯æ‘„åƒå¤´</button>
                    <button id="emotion-toggle" class="btn" disabled>å¼€å¯è¡¨æƒ…åˆ†æ</button>
                </div>

                <div class="emotion-display" style="display:none;">
                    <div class="panel-title">å½“å‰æƒ…ç»ªåˆ†æ</div>
                    <div class="emotion-result" id="emotion-result">ç­‰å¾…åˆ†æ...</div>
                    <div id="emotion-bars"></div>
                </div>
            </div>
        </div>

        <div class="chat-container">
            <div class="panel-title">å¿ƒç†åˆ†æç»“æœ</div>
            <div class="response-bubble" id="response-content">
                åœ¨è¿™é‡Œæ˜¾ç¤ºå¿ƒç†åˆ†æç»“æœ...
            </div>
        </div>
    </div>

    <script>
        /* =============== å…¨å±€å˜é‡ =============== */
        const emotionIcons = {
            'angry': 'ğŸ˜ ', 'disgust': 'ğŸ¤¢', 'fear': 'ğŸ˜¨', 
            'happy': 'ğŸ˜Š', 'sad': 'ğŸ˜¢', 'surprise': 'ğŸ˜²', 
            'neutral': 'ğŸ˜'
        };
        const emotionDescriptions = {
            'angry': 'ç”Ÿæ°”', 'disgust': 'åŒæ¶', 'fear': 'ææƒ§',
            'happy': 'å¼€å¿ƒ', 'sad': 'æ‚²ä¼¤', 'surprise': 'æƒŠè®¶', 
            'neutral': 'å¹³é™'
        };
        const emotionColors = {
            'angry': '#ff6b6b', 'disgust': '#9b59b6', 'fear': '#f39c12',
            'happy': '#2ecc71', 'sad': '#3498db', 'surprise': '#9b59b6', 
            'neutral': '#95a5a6'
        };
        
        // å½¢è±¡åç§°æ˜ å°„
        const avatarNames = {
            '1': 'æ™ºèƒ½åŠ©æ‰‹',
            '2': 'å¿ƒç†å’¨è¯¢å¸ˆ', 
            '3': 'å¿ƒçµå¯¼å¸ˆ'
        };

        let isAnalyzing = false;
        let cameraActive = false;
        let emotionAnalysisActive = false;
        let videoStream = null;
        let emotionInterval = null;
        let currentEmotion = 'neutral';
        let currentEmotionScores = {};

        // DOM å…ƒç´ 
        const statusText = document.getElementById('status-text');
        const userInput = document.getElementById('user-input');
        const submitBtn = document.getElementById('submit-btn');
        const responseContent = document.getElementById('response-content');
        const cameraPreview = document.getElementById('camera-preview');
        const cameraToggle = document.getElementById('camera-toggle');
        const emotionToggle = document.getElementById('emotion-toggle');
        const emotionDisplay = document.querySelector('.emotion-display');
        const emotionResult = document.getElementById('emotion-result');
        const emotionBars = document.getElementById('emotion-bars');
        const avatarImg = document.getElementById('avatar-img');
        const avatarVideo = document.getElementById('avatar-video');
        const videoLoading = document.getElementById('video-loading');
        const pageTitle = document.getElementById('page-title');
        const pageSubtitle = document.getElementById('page-subtitle');

        const API_BASE_URL = 'http://localhost:5000/api';

        /* =============== æ•°å­—äººå½¢è±¡ç®¡ç† =============== */
        function loadSelectedAvatar() {
            // ä» localStorage è·å–é€‰æ‹©çš„æ•°å­—äºº ID
            let selectedAvatarId = localStorage.getItem('selectedAvatar');
            
            // å¦‚æœæ²¡æœ‰é€‰æ‹©ï¼Œé»˜è®¤ä½¿ç”¨å½¢è±¡1
            if (!selectedAvatarId) {
                selectedAvatarId = '1';
                localStorage.setItem('selectedAvatar', selectedAvatarId);
            }
            
            // æ›´æ–°å‰ç«¯æ˜¾ç¤ºçš„å›¾ç‰‡
            const avatarImgUrl = `/avatars/avatar${selectedAvatarId}.png`;
            avatarImg.src = avatarImgUrl;
            
            // æ›´æ–°é¡µé¢æ ‡é¢˜æ˜¾ç¤ºå½“å‰å½¢è±¡
            const avatarName = avatarNames[selectedAvatarId] || 'æ™ºèƒ½åŠ©æ‰‹';
            pageTitle.textContent = `å¤§å­¦ç”Ÿå¿ƒç†åˆ†ææ•°å­—äººä»£ç† - ${avatarName}`;
            pageSubtitle.textContent = `å½“å‰å½¢è±¡: ${avatarName} | AIæ•°å­—äººç»“åˆè¡¨æƒ…åˆ†æï¼Œæä¾›æ›´ç²¾å‡†çš„å¿ƒç†çŠ¶æ€è¯„ä¼°`;
            
            console.log(`å·²åŠ è½½æ•°å­—äººå½¢è±¡ ${selectedAvatarId} (${avatarName})`);
            
            // ç¡®ä¿åç«¯ä¹Ÿä½¿ç”¨è¿™ä¸ªå½¢è±¡
            setSadTalkerImage(selectedAvatarId);
        }

        async function setSadTalkerImage(avatarId) {
            try {
                // è°ƒç”¨åç«¯ API æ›´æ–° SadTalker ä½¿ç”¨çš„å›¾ç‰‡
                const response = await fetch(`${API_BASE_URL}/set_avatar`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ avatar_id: avatarId })
                });
                
                const data = await response.json();
                if (data.success) {
                    console.log(`åç«¯å·²è®¾ç½®æ•°å­—äººå½¢è±¡ä¸º: ${avatarId}`);
                } else {
                    console.warn('è®¾ç½®åç«¯æ•°å­—äººå½¢è±¡å¤±è´¥:', data.error);
                }
            } catch (error) {
                console.warn('è®¾ç½®æ•°å­—äººå½¢è±¡è¯·æ±‚å¤±è´¥:', error);
            }
        }

        /* =============== æ˜¾ç¤º/éšè—è¾…åŠ© =============== */
        function showImg() {
            avatarImg.style.display = 'block';
            avatarVideo.style.display = 'none';
            videoLoading.style.display = 'none';
        }
        
        function showVideo() {
            avatarImg.style.display = 'none';
            avatarVideo.style.display = 'block';
            videoLoading.style.display = 'none';
        }

        /* =============== æ‘„åƒå¤´æ§åˆ¶ =============== */
        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'user' }
                });
                videoStream = stream;
                cameraPreview.srcObject = stream;
                cameraPreview.style.display = 'block';
                cameraToggle.textContent = 'å…³é—­æ‘„åƒå¤´';
                cameraActive = true;
                emotionToggle.disabled = false;
                statusText.textContent = 'æ‘„åƒå¤´å·²å¼€å¯';
            } catch (err) {
                console.error('æ— æ³•è®¿é—®æ‘„åƒå¤´:', err);
                alert('æ— æ³•è®¿é—®æ‘„åƒå¤´ï¼Œè¯·æ£€æŸ¥æ‘„åƒå¤´æƒé™');
            }
        }
        
        function stopCamera() {
            if (videoStream) {
                videoStream.getTracks().forEach(track => track.stop());
                videoStream = null;
            }
            cameraPreview.srcObject = null;
            cameraPreview.style.display = 'none';
            cameraToggle.textContent = 'å¼€å¯æ‘„åƒå¤´';
            cameraActive = false;
            stopEmotionAnalysis();
            emotionToggle.textContent = 'å¼€å¯è¡¨æƒ…åˆ†æ';
            emotionToggle.disabled = true;
            emotionAnalysisActive = false;
            statusText.textContent = 'ç³»ç»Ÿå°±ç»ª';
        }
        
        function toggleCamera() {
            if (cameraActive) {
                stopCamera();
            } else {
                startCamera();
            }
        }

        /* =============== è¡¨æƒ…åˆ†ææ§åˆ¶ =============== */
        function startEmotionAnalysis() {
            if (!cameraActive) return;
            emotionAnalysisActive = true;
            emotionToggle.textContent = 'åœæ­¢è¡¨æƒ…åˆ†æ';
            emotionDisplay.style.display = 'block';
            statusText.textContent = 'è¡¨æƒ…åˆ†æä¸­...';
            emotionInterval = setInterval(captureAndAnalyzeEmotion, 2000);
            captureAndAnalyzeEmotion(); // ç«‹å³æ‰§è¡Œä¸€æ¬¡
        }
        
        function stopEmotionAnalysis() {
            emotionAnalysisActive = false;
            if (emotionInterval) {
                clearInterval(emotionInterval);
                emotionInterval = null;
            }
            emotionDisplay.style.display = 'none';
            statusText.textContent = 'ç³»ç»Ÿå°±ç»ª';
        }
        
        function toggleEmotionAnalysis() {
            if (emotionAnalysisActive) {
                stopEmotionAnalysis();
            } else {
                startEmotionAnalysis();
            }
        }

        /* =============== æ•è·è¡¨æƒ… =============== */
        async function captureAndAnalyzeEmotion() {
            if (!cameraActive || !emotionAnalysisActive) return;
            
            try {
                // åˆ›å»º canvas æ•è·è§†é¢‘å¸§
                const canvas = document.createElement('canvas');
                canvas.width = 640;
                canvas.height = 480;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(cameraPreview, 0, 0, canvas.width, canvas.height);
                const imageData = canvas.toDataURL('image/jpeg', 0.7);

                // å‘é€åˆ°åç«¯åˆ†æ
                const res = await fetch(`${API_BASE_URL}/analyze_emotion`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ image: imageData })
                });
                
                const result = await res.json();
                if (result.success) {
                    currentEmotion = result.dominant_emotion;
                    currentEmotionScores = result.emotion_scores || {};
                    updateEmotionDisplay();
                    statusText.textContent = `æ£€æµ‹åˆ°: ${emotionDescriptions[currentEmotion]}`;
                }
            } catch (e) {
                console.error('è¡¨æƒ…åˆ†æå¤±è´¥:', e);
            }
        }
        
        function updateEmotionDisplay() {
            // æ›´æ–°æƒ…ç»ªç»“æœæ–‡æœ¬
            emotionResult.textContent = `${emotionIcons[currentEmotion]} ${emotionDescriptions[currentEmotion]}`;
            
            // æ¸…ç©ºæƒ…ç»ªæ¡
            emotionBars.innerHTML = '';
            
            // æŒ‰åˆ†æ•°æ’åºæ˜¾ç¤ºæ‰€æœ‰æƒ…ç»ª
            Object.entries(currentEmotionScores)
                .sort((a, b) => b[1] - a[1])
                .forEach(([emotion, score]) => {
                    const barContainer = document.createElement('div');
                    barContainer.style.margin = '5px 0';
                    
                    barContainer.innerHTML = `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
                            <span>${emotionIcons[emotion] || 'ğŸ˜'} ${emotionDescriptions[emotion] || emotion}</span>
                            <span>${score.toFixed(1)}%</span>
                        </div>
                        <div style="height: 8px; background: #eee; border-radius: 4px; overflow: hidden;">
                            <div style="height: 100%; width: ${score}%; background: ${emotionColors[emotion] || '#4a90e2'}; transition: width 0.5s;"></div>
                        </div>
                    `;
                    
                    emotionBars.appendChild(barContainer);
                });
        }

        /* =============== å¿ƒç†åˆ†æè¯·æ±‚ =============== */
        async function analyzeInput() {
            const text = userInput.value.trim();
            if (!text || isAnalyzing) return;
            
            // è®¾ç½®çŠ¶æ€
            isAnalyzing = true;
            statusText.textContent = 'åˆ†æä¸­...';
            submitBtn.disabled = true;
            videoLoading.style.display = 'block';
            showImg(); // å…ˆç¡®ä¿æ˜¾ç¤ºå›¾ç‰‡ï¼Œéšè—è§†é¢‘

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            responseContent.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨åˆ†æä½ çš„å¿ƒç†çŠ¶æ€å¹¶ç”Ÿæˆæ•°å­—äººè§†é¢‘...</p>
                </div>
            `;
            
            try {
                const payload = {
                    message: text,
                    detected_emotion: currentEmotion,
                    generate_video: true
                };
                
                const res = await fetch(`${API_BASE_URL}/analyze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const data = await res.json();
                if (data.success) {
                    // æ„å»ºå“åº”HTML
                    let html = data.response;
                    
                    // æ·»åŠ æ¨¡å‹æ¥æºå’Œæƒ…ç»ªä¿¡æ¯
                    html += `
                        <div style="margin-top: 20px; padding: 10px; background: rgba(110,203,245,.1); border-radius: 8px; font-size: 14px; color: #3498db">
                            <strong>${data.model_source === 'local_psychology_model' ? 'ğŸ§  æœ¬åœ°å¿ƒç†å¤§æ¨¡å‹' : 'ğŸ¤– DeepSeek AI'} ç”Ÿæˆ</strong> | 
                            æƒ…ç»ªçŠ¶æ€: ${emotionDescriptions[currentEmotion]} ${emotionIcons[currentEmotion]}
                        </div>
                    `;
                    
                    responseContent.innerHTML = html;

                    // å¦‚æœæœ‰ç”Ÿæˆçš„è§†é¢‘
                    if (data.video_generated && data.video_url) {
                        avatarVideo.src = data.video_url;
                        showVideo(); // éšè—å›¾ç‰‡ï¼Œæ˜¾ç¤ºè§†é¢‘
                        avatarVideo.play();
                        statusText.textContent = 'åˆ†æå®Œæˆï¼Œè§†é¢‘å·²ç”Ÿæˆ';
                        
                        // è§†é¢‘æ’­æ”¾ç»“æŸåæ¢å¤æ˜¾ç¤ºå›¾ç‰‡
                        avatarVideo.onended = () => {
                            showImg();
                        };
                    } else {
                        showImg();
                        if (data.video_error) {
                            console.warn('è§†é¢‘ç”Ÿæˆå¤±è´¥:', data.video_error);
                        }
                        if (data.tts_error) {
                            console.warn('TTS å¤±è´¥:', data.tts_error);
                        }
                        statusText.textContent = 'åˆ†æå®Œæˆï¼ˆè§†é¢‘ç”Ÿæˆå¤±è´¥ï¼‰';
                    }
                } else {
                    throw new Error(data.error || 'API è¯·æ±‚å¤±è´¥');
                }
            } catch (err) {
                console.error('åˆ†æå¤±è´¥:', err);
                showImg();
                responseContent.innerHTML = `
                    <div style="color: #e74c3c;">
                        <p><strong>åˆ†æå¤±è´¥:</strong> ${err.message}</p>
                        <p>è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•</p>
                    </div>
                `;
                statusText.textContent = 'åˆ†æå¤±è´¥';
            } finally {
                // æ¢å¤çŠ¶æ€
                isAnalyzing = false;
                submitBtn.disabled = false;
                userInput.value = '';
                userInput.focus();
            }
        }

        /* =============== åˆå§‹åŒ– =============== */
        document.addEventListener('DOMContentLoaded', () => {
            // 1. é¦–å…ˆåŠ è½½é€‰æ‹©çš„æ•°å­—äººå½¢è±¡
            loadSelectedAvatar();
            
            // 2. æ£€æŸ¥æ˜¯å¦æœ‰é€‰æ‹©æ•°å­—äººï¼Œå¦‚æœæ²¡æœ‰åˆ™è·³è½¬åˆ°é€‰æ‹©é¡µé¢
            if (!localStorage.getItem('selectedAvatar')) {
                setTimeout(() => {
                    alert('è¯·å…ˆé€‰æ‹©æ•°å­—äººå½¢è±¡');
                    window.location.href = '/select';
                }, 500);
                return;
            }
            
            // 3. ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
            submitBtn.addEventListener('click', analyzeInput);
            userInput.addEventListener('keypress', e => {
                if (e.key === 'Enter') analyzeInput();
            });
            cameraToggle.addEventListener('click', toggleCamera);
            emotionToggle.addEventListener('click', toggleEmotionAnalysis);
            
            // 4. å»¶è¿Ÿè¯¢é—®æ˜¯å¦å¼€å¯æ‘„åƒå¤´
            setTimeout(() => {
                const enableCamera = confirm('æ˜¯å¦å¼€å¯æ‘„åƒå¤´è¿›è¡Œè¡¨æƒ…åˆ†æï¼Ÿ\n\nå¼€å¯æ‘„åƒå¤´å¯ä»¥å®æ—¶åˆ†ææ‚¨çš„é¢éƒ¨è¡¨æƒ…ï¼Œæä¾›æ›´ç²¾å‡†çš„å¿ƒç†åˆ†æã€‚\n\næ³¨æ„ï¼šæ‘„åƒå¤´æ•°æ®ä»…ç”¨äºæœ¬åœ°è¡¨æƒ…åˆ†æï¼Œä¸ä¼šè¢«ä¿å­˜æˆ–ä¸Šä¼ ã€‚');
                if (enableCamera) {
                    startCamera();
                }
            }, 1000);
        });
    </script>
</body>
</html>